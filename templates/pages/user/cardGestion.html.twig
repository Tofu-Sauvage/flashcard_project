{% extends "base.html.twig" %}

{% block title %}Gestion des cartes{% endblock %}

{% block body %}

	{% for message in app.flashes('success') %}

	<div class="alert alert-success mt-4">
		<button
		  type="button"
		  class="close"
		  data-dismiss="alert"
		  aria-label="Close"
		  onclick="delete_flash(this)"
		>
		  <i class="material-icons">close</i>
		</button>
		<span>
		  {{ message }}
		</span>
	  </div>
	  
	{% endfor %}

	<div class="container-fluid">
	<div class="alert alert-success">
		<h2>Gestion des cartes de {{ app.user.name }}</h2>
	</div>

		<div class="row">
			<div class="col-md-4">
				{# Colonne de selction d'une nouvelle carte #}
				<div class="card">
          <div class="card-header card-header-tabs card-header-info">
            <p class="h3">Créer une carte</p>
					</div>
					<div class="card-body">
						{% for category in categories %}
							<a class="btn btn-primary" href="{{ path('card-create', {categoryId: category.id}) }}">Créer une carte "{{category.name}}"</a>
						{% endfor %}
					</div>
				</div>
				<div>
            <a href="{{ path('deckboard') }}" 
            type="button" 
            class="btn btn-primary btn-round">
            <span class="material-icons">keyboard_return</span>
            Retour au deckboard</a>
          </div>
			</div>

			<div class="col-md-8">
				{# Colonne d'affichage des cartes #}
				<div class="card">
					<div class="card-header card-header-tabs card-header-warning">
						<div class="nav-tabs-navigation">
							<p class="h3">
								{% set count = 0 %} {% for card in cards %} {% set count = count + 1 %}
								{% endfor %} {{ count }} cartes créées
							</p>
						</div>
					</div>
					<div class="card-body">
						<div class="tab-content table-responsive">
							<div class="tab-panel active">
								<table class="table" id="cardtable">
									<thead>
										<tr>
											<th class="text-warning" style="cursor: pointer" onclick="sortTable('cardtable', 0)">Langue<i class="material-icons icon">keyboard_arrow_up</i>
											</th>
											<th class="text-warning" style="cursor: pointer" onclick="sortTable('cardtable', 1)">Catégorie<i class="material-icons icon">keyboard_arrow_up</i>
											</th>
											<th class="text-warning" style="cursor: pointer" onclick="sortTable('cardtable', 2)">Question<i class="material-icons icon">keyboard_arrow_up</i>
											</th>
											<th class="text-warning" style="cursor: pointer" onclick="sortTable('cardtable', 3)">Créée le<i class="material-icons icon">keyboard_arrow_up</i>
											</th>
											<th class="text-warning" style="cursor: pointer" onclick="sortTable('cardtable', 4)">Decks<br>concernés<i class="material-icons icon">keyboard_arrow_up</i>
											</th>
											<th class="text-warning">Voir</th>
										</tr>
									</thead>
									<tbody>
										{% for card in paginationCards %}
											<tr>
												<td>{{ card.author.languageLearn.name }}</td>
												<td>{{ card.category.name }}</td>
												<td>
													{{ card.question |length > 20 ? card.question|slice(0, 20) ~ '...' : card.question }}
												</td>
												<td>{{ card.createdAt | date("d/m/Y") }}</td>
												<td>
													{% set count = 0 %}{% for deck in card.decks %}{% set  count = count + 1 %}{% endfor %}
													{{ count }}
												</td>

												<td class="td-actions text-right">
													<a href="{{ path('card-detail', { id: card.id }) }}">
														<button type="button" rel="tooltip" title="" class="btn btn-white btn-link btn-sm">
															<i class="material-icons">remove_red_eye</i>
														</button>
													</a>
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
								{{ knp_pagination_render(paginationCards) }}

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}
