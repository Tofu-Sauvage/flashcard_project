{% extends './pages/administration/admin.base.html.twig'%} {%block body%}

<div class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-6 col-md-12">
        <div class="card">
          <p class="h4 card-header card-header-info">Nom : {{ deck.name }}</p>
          <div class="card-footer">
            <div class="stats">
              <i class="material-icons text-info">bookmarks</i>
              <a href="{{ path('admin-decks') }}" class="info-link"
                >Retour à la liste</a
              >
            </div>
          </div>
          <div class="card-body">
            <div class="tab-content">
              <div class="tab-pane active">
                <table class="table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Auteur</th>
                      <th>Langue</th>
                      <th>Créée le</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>{{ deck.id }}</td>
                      <td><a href="{{ path('admin-user', { id:  deck.author.id }) }}">{{ deck.author.name }}</a></td>
                      <td><a href="{{ path('language-details', { id:  deck.author.languageLearn.id }) }}"
                        >{{ deck.author.languageLearn.name }}</a></td>
                      <td>{{deck.createdAt | date("d/m/Y") }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <p class="card-text">Description : {{ deck.description }}</p>
            <p class="card-text">
              Statut : {% if deck.public == 1 %} public {% else %} privé {%endif%}
            </p>

            {% if tagsTable is not null %}
            <p class="card-text" style="display: inline;">Tags associés : 
            {% for tag in tagsTable %}
              <button class="btn btn-info btn-sm" onclick="relancerRecherche()">{{tag}}</button>
            {% endfor %}</p>
            {% else %} 
            <p class="card-text text-info">Pas de tags associés.</p>
            {% endif %}

            <p class="h3">
              {% set count = 0 %} {% for card in deck.cards %} {% set count =
              count + 1 %} {% endfor %} 
              {% if count == 0 %}
              <p class="text-info">Pas encore de carte.</p>
              {% else %}
              {{ count }} cartes associées :
            </p>

            <table class="table text-left">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Catégorie</th>
                  <th>Créée le</th>
                  <th>Voir</th>
                </tr>
              </thead>
              <tbody>
                {% for card in deck.cards%}

                <tr>
                  <td>{{ card.id }}</td>
                  <td><a href="{{ path('category-details', { id:  card.category.id }) }}"
                    >{{ card.category.name }}</a></td>
                  <td>{{card.createdAt | date("d/m/Y") }}</td>
                  <td class="td-actions">
                    <a href="{{ path('admin-card', { id: card.id }) }}"
                      ><button
                        type="button"
                        rel="tooltip"
                        title=""
                        class="btn btn-white btn-link btn-sm"
                      >
                        <i class="material-icons">remove_red_eye</i>
                      </button></a
                    >
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
              {% endif %}
            <div class="text-center">
              <form
              method="POST"
              action="{{ path('admin-deck-delete', { id: deck.id }) }}"
              onsubmit="return confirm('Supprimer ce deck ?')"
              >
              <button class="btn btn-danger btn-round">supprimer</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-6 col-md-12">
        <div class="card card-stats">
          <div class="card-header card-header-info card-header-icon">
            <div class="card-icon">
              <i class="material-icons">supervised_user_circle</i>
            </div>
            {% set count = 0 %} {% for user in users %}{% for favorite in user.favorites %}
            {% if favorite.id == deck.id %}
            {% set count =
              count + 1 %} {%endif%}{% endfor %}{% endfor %}
              {% if count == 0 %}
              <p class="card-category">Aucun utilisateur n'a ce deck en favori.</p>
              {% else %}
              <p class="card-category">Utilisateur(s) ayant ce deck en favori</p>
              <p class="h3 card-title">
              {{ count }}
            </p>

          </div>
          <div class="card-body">
            <table class="table text-left" id="table">
              <thead>
                <tr>
                  <th class="text-info" style="cursor: pointer" onclick="sortTable(0)">ID<i class="material-icons">import_export</i></th>
                  <th class="text-info" style="cursor: pointer" onclick="sortTable(1)">Nom<i class="material-icons">import_export</i></th>
                  <th class="text-info">Voir</th>
                </tr>
              </thead>
              <tbody>
                {% for user in users %}{% for favorite in user.favorites %}
            {% if favorite.id == deck.id %}
                <tr>
                  <td>{{ user.id }}</td>
                  <td> <a href="{{ path('admin-user', { id: user.id }) }}"
                    >{{ user.name }}</a></td>
                  <td class="td-actions">
                    <a href="{{ path('admin-user', { id: user.id }) }}"
                      ><button
                        type="button"
                        rel="tooltip"
                        title=""
                        class="btn btn-white btn-link btn-sm"
                      >
                        <i class="material-icons">remove_red_eye</i>
                      </button></a
                    >
                  </td>
                </tr>
                {%endif%}{% endfor %}{% endfor %}
              </tbody>
            </table>
          </div>
                     {%endif%}

        </div>
      </div>
    </div>
  </div>
</div>

{% endblock body%}
